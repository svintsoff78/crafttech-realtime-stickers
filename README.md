# Crafttech

### Суть

Разработка платформы для совместной работы на виртуальных досках

### Задание

Создать минимальный, но хорошо-структурированный прототип модуля «Стикеры»,
который:

1. Обеспечивает CRUD-операции через REST-API. (смотреть следующий пункт)
2. Рассылает события об операциях всем подключённым клиентам по WebSocket.
3. Демонстрирует ваш подход к архитектуре, стилю кода и его эффективности.

### Несогласие с необходимостью REST API CRUD

Текущая реализация модуля предусматривает только сокетное взаимодействие, 
при этом сервис для работы с БД может быть подключенным в REST контроллер.

Такой подход более подходит для реализации бизнес-задачи, потому что:
1. **Cнижение round-trip задержек.** В текущей реализации клиент сам может сгенерировать 
UUID стикера и передать в сокет, благодаря этому UI не должен дожидаться создания стикера для того, 
чтобы пересобрать стейт. 
2. **Точка роста бизнеса.** Это расширяет бизнес-возможности - возможна простая реализация оффлайн создания 
стикера при потере соединения и отправке батч-запроса при его возобновлении
3. **Производительность.** Операции стремительно частые и REST может не справляться с частотой, а WS как раз создан для
частого общения клиентов в real-time между собой
4. **Поддержка.** Поддерживать один гейтвей значительно проще, чем гейтвей с прикрученным сверху REST контроллером
5. **Взаимодействие.** В случае с контроллером и гейтвеем в UI придется создавать в одном компоненте два инстанса
запросов - HTTP и WS. Поддерживать одно соединение со всем необходимым функционалом  значительно проще.

# Дорожная карта

- Глобальные модули переделать на forFeature / forRoot, чтобы импортировать просто сервис через DI
- Завернуть приложение в докер, чтобы запускать все в один тык

# Запуск

### События

### ВАЖНО!

Не рекомендую INSOMNIA к тестированию, потому что как минимум на macos синхронизируется body между реквестами
в коллекции, поэтому экспорт коллекции особой помощи не даст, к тестированию рекомендую Postman

Ссылка на коллекцию Postman - https://cryptoupik-8849121.postman.co/workspace/%D0%AF%D0%BD-%D0%A1%D0%B2%D0%B8%D0%BD%D1%86%D0%BE%D0%B2's-Workspace~3b425599-f618-4f48-81e7-89fcf7623e13/collection/692dab51347ffaab85ec9e40?action=share&creator=50486505

create_sticker, update_sticker и delete_sticker требуют наличие подключения к конкретной доске, поэтому 
при присоединение клиента к сокету надо отправить сообщение на join_board с айди доски, чтобы клиент попал в
пул участников доски

Входящие события:
- join_board
- create_sticker
- update_sticker
- delete_sticker

Исходящие события:
- board_state
- sticker_created
- sticker_updated
- sticker_deleted
- exception

### Настроить .env

.env.example уже содержит нужные значения в рамках тестового задания, нужно переименовать в .env

### Запуск БД и Кафки

```shell
docker-compose up -d
```

### Вкатить миграцию

```shell
npm run db:migrate
```

### Установка зависимостей

```shell
npm install
```

### Запуск приложения

```shell
npm run start:dev
```
